# 🏆 2024년 기상 빅데이터 콘테스트 대상(1위) 수상작: 연도별 Fold 기반 XGBoost 앙상블을 통한 전력기상지수 예측 모델

## 📈 프로젝트 개요

본 레포지토리는 2024년 기상청 주최 및 한국전력공사 후원의 기상 빅데이터 콘테스트에서 **대상(1위)**을 수상한 '파부햄' 팀(김현지, 정민찬)의 예측 모델 코드입니다.

본 프로젝트는 기상 데이터를 활용하여 공동주택의 전력 수요를 나타내는 **전력기상지수**를 예측하는 모델을 개발하는 것을 목표로 합니다. 저희 팀은 베이스라인 모델의 격자별 상관계수 평균 점수인 0.940을 **0.984**로 크게 향상시키며 모델의 정확성과 안정성을 입증했습니다.

---

## 🚀 기여 및 핵심 기능 (Our Contribution & Key Features)

저희 모델은 다음과 같은 세 가지 전략에 기반합니다.

#### 1. 전력 사용량 특성을 반영한 Feature Engineering
- **도시 규모 및 주택 수 변수 생성**: 동네예보 격자 정보를 행정구역 데이터와 결합하여 도시 규모를 4단계(`district`)로 분류하고, 이를 One-Hot 인코딩하여 위치적 특성을 모델에 반영했습니다. 또한, 검증 데이터에 부재한 주택 수(`units`)를 연도별 추이를 로그 스케일에서 선형 보간하여 예측함으로써 중요한 변수를 확보했습니다.
- **생활 패턴을 고려한 시간 변수**: 요일, 월, 시간 등 기본적인 주기성 변수뿐만 아니라, 출퇴근 및 생활 패턴을 고려한 `routine` 변수를 자체적으로 정의하여 시간의 흐름에 따른 전력 사용량 변화를 모델이 학습하도록 했습니다.
- **과거 기상 정보를 활용한 지연 변수(Time-Lagged Features)**: 현재 전력 수요는 과거의 기상 상태에 영향을 받는다는 가정 하에, 최대 24시간 전까지의 주요 기상 변수(체감온도, 불쾌지수 등)를 3시간 단위로 평균 내어 8개의 지연 변수를 생성했습니다. 이를 통해 모델이 기온의 누적 효과를 학습할 수 있도록 했습니다.

#### 2. 대용량 데이터를 활용한 효율적인 모델 개발
- **자동화된 초매개변수 최적화**: `Optuna`의 베이지안 최적화 기법(TPESampler)을 활용하여 넓은 탐색 공간에서 최적의 초매개변수 조합을 효율적으로 탐색했습니다.
- **GPU 가속화**: `CuPy`와 XGBoost의 `QuantileDMatrix`를 활용하여 GPU 연산을 극대화함으로써 대용량 데이터의 전처리 및 학습 시간을 크게 단축했습니다.

#### 3. 모델 일반화 성능 확보
- **연도별 교차 검증 (Year-based Cross Validation)**: 시계열 데이터의 특성을 고려하여, 특정 연도를 검증 데이터로 사용하는 3-Fold 교차 검증을 수행했습니다. 이를 통해 미래의 보지 못한 데이터에 대한 모델의 일반화 성능을 높였습니다.
- **가중 평균 앙상블**: 연도별 교차 검증으로 학습된 3개의 모델과 전체 데이터로 학습한 모델, 그리고 주택 수 변수 포함/미포함 모델 등 총 8개의 예측 결과를 가중 평균하여 최종 예측값을 도출했습니다. 이 앙상블 기법은 단일 모델의 오차를 보완하고 예측 안정성을 크게 향상시켰습니다.

---

## 🛠️ 사용한 Python Package

- **Core**: XGBoost, Optuna, CuPy
- **Data Handling**: Pandas, NumPy, Scikit-learn
- **Visualization**: Matplotlib, Seaborn, Cartopy, GeoPandas

---

## 📂 프로젝트 구조

```
.
├── configs/              # 모델 및 데이터 처리 관련 설정 파일
├── data/                 # 전처리된 데이터 및 NPZ 파일 저장 경로
├── figure/               # 분석 및 결과 시각화 자료
├── notebooks/            # 데이터 분석, 시각화, 앙상블 관련 주피터 노트북
├── preprocessing/        # 원본 데이터 전처리 파이프라인 (주피터 노트북)
├── utils/                # 데이터 로딩, 평가, 플로팅 등 유틸리티 함수
├── xgboost_utils/        # XGBoost 모델 학습 관련 유틸리티 (데이터 관리, 콜백, 메트릭)
├── run.py                # 모델 학습 및 Optuna 최적화 실행 스크립트
├── environment.yml       # Conda 환경 설정 파일
└── readme.md             # 프로젝트 설명 파일
```

---

## ⚙️ 실행 방법

1.  **환경 설정**
    ```bash
    conda env create -f environment.yml
    conda activate cuboost
    ```

2.  **경로 설정**
    `configs/base.yaml` 파일 내의 `repo_path`, `data_path`, `output_path`, `asset_path` 등 주요 경로를 사용자 환경에 맞게 수정합니다.

3.  **데이터 전처리**
    `preprocessing/` 디렉토리의 주피터 노트북들을 `1`번부터 `5`번까지 순서대로 실행하여 모델 학습에 필요한 데이터를 생성합니다.
    > **Note**: `1_raw_data_polishing.ipynb`에서 공휴일 정보를 가져오기 위한 공공데이터포털 API 키가 필요할 수 있습니다.

4.  **모델 학습 및 예측**
    최종 제출에 사용된 설정으로 모델을 학습하고 예측을 수행합니다.
    ```bash
    # 주택 수 변수를 포함한 모델
    python3 run.py --config submit_with_units.yaml

    # 주택 수 변수를 제외한 모델
    python3 run.py --config submit_without_units.yaml
    ```

5.  **결과 확인 및 앙상블**
    - `run.py` 실행 후 `output_path`로 지정된 경로에서 개별 모델의 예측 결과를 확인할 수 있습니다.
    - `notebooks/submit_1_ensemble.ipynb` 노트북을 사용하여 저장된 예측 결과들을 앙상블하여 최종 제출 파일을 생성할 수 있습니다. (경로 수정 필요)

---

## 💡 향후 활용 방안

1.  **전력 사용 특성을 반영한 데이터 보강**: 건물의 규모, 층수, 단열 성능, 냉난방 방식 등 주거 특성 데이터를 추가하여 예측 정확도를 더욱 향상시킬 수 있습니다.
2.  **신재생에너지 수급 관리**: 정확한 전력 수요 예측은 태양광, 풍력 등 변동성이 큰 신재생에너지원의 안정적인 전력망 통합 및 운영에 기여할 수 있습니다.
3.  **기후 변화 대응 정책 지원**: 폭염, 한파 등 이상 기후 발생 시 지역별 전력 수요 변화를 예측하여 선제적인 전력 공급 관리 및 비상 대응 체계를 구축하는 데 활용될 수 있습니다.

---

## 👥 팀원

- **김현지**: 전처리 파이프라인 구축, 전력 시장 및 세대별 전력 사용 패턴 분석, 변수 개발 및 활용 방안 제시 
- **정민찬**: XGBoost 앙상블 기반 모델 아키텍처 설계, GPU 및 메모리 최적화를 통한 개발 가속화